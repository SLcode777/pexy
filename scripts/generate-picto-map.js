#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

/**
 * Script to automatically generate the pictogram mapping file
 * Run: node scripts/generate-picto-map.js
 */

const PICTOS_DIR = path.join(__dirname, '../assets/pictos');
const OUTPUT_FILE = path.join(__dirname, '../components/PictogramImageMap.ts');

// Recursively find all .webp files
function findWebpFiles(dir, baseDir = dir) {
  let results = [];
  const files = fs.readdirSync(dir);

  for (const file of files) {
    const filePath = path.join(dir, file);
    const stat = fs.statSync(filePath);

    if (stat.isDirectory()) {
      results = results.concat(findWebpFiles(filePath, baseDir));
    } else if (file.endsWith('.webp')) {
      // Get relative path from assets/pictos
      const relativePath = path.relative(baseDir, filePath);
      // Convert to forward slashes for consistency
      const normalizedPath = relativePath.replace(/\\/g, '/');
      results.push(normalizedPath);
    }
  }

  return results;
}

// Generate the TypeScript file
function generateMapping() {
  console.log('üîç Scanning for .webp files...');

  const webpFiles = findWebpFiles(PICTOS_DIR);

  console.log(`‚úÖ Found ${webpFiles.length} images`);

  // Sort alphabetically for consistency
  webpFiles.sort();

  // Generate the file content
  let content = `// This file is auto-generated by scripts/generate-picto-map.js
// Do not edit manually - run: node scripts/generate-picto-map.js

export const PICTOGRAM_IMAGE_MAP: Record<string, any> = {
`;

  for (const file of webpFiles) {
    const key = `assets/pictos/${file}`;
    const requirePath = `@/assets/pictos/${file}`;
    content += `  '${key}': require('${requirePath}'),\n`;
  }

  content += `};\n`;

  // Write to file
  fs.writeFileSync(OUTPUT_FILE, content, 'utf8');

  console.log(`‚ú® Generated mapping file: ${OUTPUT_FILE}`);
  console.log(`üì¶ Total images: ${webpFiles.length}`);
}

// Run
try {
  generateMapping();
} catch (error) {
  console.error('‚ùå Error:', error.message);
  process.exit(1);
}
